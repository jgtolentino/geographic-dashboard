(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[308],{66781:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scout-dashboard",function(){return s(59835)}])},59835:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return M}});var a=s(85893),r=s(67294);let n=(0,s(56844).eI)("https://cxzllzyxwpyptfretryc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN4emxsenl4d3B5cHRmcmV0cnljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNzYxODAsImV4cCI6MjA2Nzk1MjE4MH0.b794GEIWE4ZdMAm9xQYAJ0Gx-XEn1fhJBTIIeTro_1g");var l=s(39958),i=s(84770),o=s(18329),c=s(38168),d=s(37705),u=s(48235),m=s(18796),x=s(71929),h=s(24427),g=s(87680);function f(e){let{lastUpdated:t,onRefresh:s}=e;return(0,a.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Scout Dashboard"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Real-time Analytics"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Live"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["Last updated: ",t]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:s,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh"}),(0,a.jsx)("button",{className:"px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors",children:"Share"}),(0,a.jsx)("button",{className:"px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors",children:"Export"})]})]})]})})}function p(e){let t,{data:s}=e,r=e=>e.toLocaleString(),n=e=>"".concat(e>0?"+":"").concat(e,"%");return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Executive Overview"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Real-time insights across all Scout Dashboard modules"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-blue-600",children:"Total Revenue"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-900",children:(t=(null==s?void 0:s.totalRevenue)||0,"₱".concat((t/1e6).toFixed(2),"M"))}),(0,a.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,a.jsx)("span",{className:"font-medium ".concat((null==s?void 0:s.revenueGrowth)>=0?"text-green-600":"text-red-600"),children:n((null==s?void 0:s.revenueGrowth)||0)})," vs last month"]})]}),(0,a.jsx)("div",{className:"w-12 h-12 bg-blue-200 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})})]})}),(0,a.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-green-600",children:"Total Transactions"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-900",children:r((null==s?void 0:s.totalTransactions)||0)}),(0,a.jsxs)("p",{className:"text-sm text-green-700",children:[(0,a.jsx)("span",{className:"font-medium ".concat((null==s?void 0:s.transactionGrowth)>=0?"text-green-600":"text-red-600"),children:n((null==s?void 0:s.transactionGrowth)||0)})," vs last month"]})]}),(0,a.jsx)("div",{className:"w-12 h-12 bg-green-200 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})})]})}),(0,a.jsx)("div",{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-purple-600",children:"Active Stores"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-purple-900",children:r((null==s?void 0:s.activeStores)||0)}),(0,a.jsxs)("p",{className:"text-sm text-purple-700",children:[(0,a.jsxs)("span",{className:"font-medium text-green-600",children:["+",(null==s?void 0:s.newStores)||0]})," new this month"]})]}),(0,a.jsx)("div",{className:"w-12 h-12 bg-purple-200 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})})]})}),(0,a.jsx)("div",{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-orange-600",children:"Avg Basket Size"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-orange-900",children:(null==s?void 0:s.avgBasketSize)||0}),(0,a.jsxs)("p",{className:"text-sm text-orange-700",children:[(0,a.jsx)("span",{className:"font-medium ".concat((null==s?void 0:s.basketGrowth)>=0?"text-green-600":"text-red-600"),children:n((null==s?void 0:s.basketGrowth)||0)})," items per transaction"]})]}),(0,a.jsx)("div",{className:"w-12 h-12 bg-orange-200 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-6 h-6 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m5.5-5v6a1 1 0 01-1 1H9a1 1 0 01-1-1v-6m8 0V9a1 1 0 00-1-1H9a1 1 0 00-1 1v4.01"})})})]})})]})]})}function v(e){let{data:t}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Revenue Trend"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Monthly revenue performance"})]}),(0,a.jsx)("button",{className:"text-sm text-blue-600 hover:text-blue-800",children:"View Details"})]}),(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(l.h,{width:"100%",height:"100%",children:(0,a.jsxs)(i.T,{data:t||[],children:[(0,a.jsx)("defs",{children:(0,a.jsxs)("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,a.jsx)("stop",{offset:"5%",stopColor:"#3B82F6",stopOpacity:.3}),(0,a.jsx)("stop",{offset:"95%",stopColor:"#3B82F6",stopOpacity:0})]})}),(0,a.jsx)(o.q,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),(0,a.jsx)(c.K,{dataKey:"month",stroke:"#6B7280"}),(0,a.jsx)(d.B,{stroke:"#6B7280",tickFormatter:e=>"₱".concat((e/1e6).toFixed(1),"M")}),(0,a.jsx)(u.u,{formatter:e=>["₱".concat((e/1e6).toFixed(2),"M"),"Revenue"],labelStyle:{color:"#374151"}}),(0,a.jsx)(m.u,{type:"monotone",dataKey:"revenue",stroke:"#3B82F6",strokeWidth:2,fillOpacity:1,fill:"url(#colorRevenue)"})]})})})]})}function b(e){let{data:t}=e,s=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4"];return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Category Mix"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Product category distribution"}),(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,a.jsx)("div",{className:"flex-1 h-64",children:(0,a.jsx)(l.h,{width:"100%",height:"100%",children:(0,a.jsxs)(x.u,{children:[(0,a.jsx)(h.b,{data:t||[],cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"percentage",label:e=>{let{name:t,percentage:s}=e;return"".concat(t," ").concat(s,"%")},children:(t||[]).map((e,t)=>(0,a.jsx)(g.b,{fill:s[t%s.length]},"cell-".concat(t)))}),(0,a.jsx)(u.u,{})]})})}),(0,a.jsx)("div",{className:"space-y-3",children:(t||[]).slice(0,5).map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:s[t%s.length]}}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.category}),(0,a.jsxs)("span",{className:"text-gray-600 ml-2",children:[e.percentage,"%"]})]})]},e.category))})]})]})}function j(e){let{data:t}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Regional Performance"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Transaction volume and revenue by region"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Live Data"}),(0,a.jsx)("button",{className:"text-sm text-blue-600 hover:text-blue-800",children:"View Map"})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:(t||[]).slice(0,5).map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.region}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[e.transactions.toLocaleString()," transactions"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-semibold text-gray-900",children:["₱",(e.revenue/1e6).toFixed(2),"M"]}),(0,a.jsxs)("p",{className:"text-sm font-medium ".concat(e.growth>=0?"text-green-600":"text-red-600"),children:[e.growth>=0?"+":"",e.growth.toFixed(1),"%"]})]})]},e.region))})]})}function y(e){var t;let{data:s}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900",children:"Transaction Trends"}),(0,a.jsx)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"Live"})]}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(null==s?void 0:null===(t=s.todayTransactions)||void 0===t?void 0:t.toLocaleString())||0}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"transactions today"})]})}function N(e){let{data:t}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900",children:"Product Mix"}),(0,a.jsx)("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"New"})]}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(null==t?void 0:t.totalSKUs)||0}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"SKUs"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Top: ",null==t?void 0:t.topCategory," (",null==t?void 0:t.topCategoryPercentage,"%)"]})]})}function w(e){let{data:t}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900",children:"Consumer Behavior"}),(0,a.jsx)("span",{className:"text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded",children:"Active"})]}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[(null==t?void 0:t.brandedRequestsPercentage)||0,"%"]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"branded requests"})]})}function S(e){let{data:t}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900",children:"Consumer Profiling"}),(0,a.jsx)("span",{className:"text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded",children:"Active"})]}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(null==t?void 0:t.newSegments)||0}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"new segments identified"})]})}function _(){let{insights:e,loading:t,refresh:s}=function(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)(!1),l=(0,r.useCallback)(async()=>{a(!0);try{let{data:e}=await n.from("scout.silver_transactions_cleaned").select("*").gte("timestamp",new Date(Date.now()-864e5).toISOString()).limit(100),s=["".concat((null==e?void 0:e.length)||0," transactions processed in the last 24 hours"),"Beverages showing 12% growth vs last week","Metro Manila maintaining strongest regional performance","Suggestion acceptance rate increased to 68%","New consumer segment identified: Urban Millennials"];t(s)}catch(e){console.error("Error generating insights:",e)}finally{a(!1)}},[]);return(0,r.useEffect)(()=>{l();let e=setInterval(l,6e5);return()=>clearInterval(e)},[l]),{insights:e,loading:s,refresh:l}}();return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"AI Assistant"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{className:"px-3 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:"Insights"}),(0,a.jsx)("button",{className:"px-3 py-1 text-xs bg-gray-100 text-gray-600 rounded",children:"Actions"}),(0,a.jsx)("button",{className:"px-3 py-1 text-xs bg-gray-100 text-gray-600 rounded",children:"Chat"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:"Key Insights"}),(0,a.jsx)("button",{onClick:s,className:"text-sm text-blue-600 hover:text-blue-800",children:"Refresh"})]}),t?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})}):(0,a.jsx)("div",{className:"space-y-3",children:e.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full mt-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:e})]},t))})]})]})}var k=function(){let{kpis:e,revenueTrend:t,categoryMix:s,regionalPerformance:l,transactionTrends:i,productMix:o,consumerBehavior:c,consumerProfiling:d,isLoading:u,hasError:m,refreshAll:x,lastUpdated:h}=function(){var e;let t=function(){let[e,t]=(0,r.useState)(null),[s,a]=(0,r.useState)(!0),[l,i]=(0,r.useState)(null),o=(0,r.useCallback)(async()=>{try{var e,s;a(!0);let{data:r}=await n.from("scout.silver_transactions_cleaned").select("timestamp").order("timestamp",{ascending:!1}).limit(1);if(!r||0===r.length)throw Error("No transaction data available");let l=new Date(r[0].timestamp),i="".concat(l.getFullYear(),"-").concat(String(l.getMonth()+1).padStart(2,"0")),o=new Date(l.getFullYear(),l.getMonth()-1,1),c="".concat(o.getFullYear(),"-").concat(String(o.getMonth()+1).padStart(2,"0")),[d,u]=await Promise.all([n.from("scout.silver_transactions_cleaned").select("peso_value, basket_size, store_id").gte("timestamp","".concat(i,"-01")).lte("timestamp","".concat(i,"-31")),n.from("scout.silver_transactions_cleaned").select("peso_value, basket_size, store_id").gte("timestamp","".concat(c,"-01")).lte("timestamp","".concat(c,"-31"))]);if(d.error||u.error)throw Error("Failed to fetch KPI data");let m=(d.data||[]).reduce((e,t)=>e+Number(t.peso_value||0),0),x=(null===(e=d.data)||void 0===e?void 0:e.length)||0,h=new Set((d.data||[]).map(e=>e.store_id).filter(Boolean)).size,g=x>0?(d.data||[]).reduce((e,t)=>e+Number(t.basket_size||0),0)/x:0,f=(u.data||[]).reduce((e,t)=>e+Number(t.peso_value||0),0),p=(null===(s=u.data)||void 0===s?void 0:s.length)||0,v=new Set((u.data||[]).map(e=>e.store_id).filter(Boolean)).size,b=p>0?(u.data||[]).reduce((e,t)=>e+Number(t.basket_size||0),0)/p:0;t({totalRevenue:m,revenueGrowth:f>0?Math.round((m-f)/f*100):0,totalTransactions:x,transactionGrowth:p>0?Math.round((x-p)/p*100):0,activeStores:h,newStores:v>0?Math.round((h-v)/v*100):0,avgBasketSize:g,basketGrowth:b>0?Math.round((g-b)/b*100):0,lastUpdated:new Date().toISOString(),dataMonth:i})}catch(e){i(e instanceof Error?e.message:"Failed to fetch KPIs")}finally{a(!1)}},[]);return(0,r.useEffect)(()=>{o();let e=setInterval(o,3e5);return()=>clearInterval(e)},[o]),{data:e,loading:s,error:l,refresh:o}}(),s=function(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)(!0),[l,i]=(0,r.useState)(null),o=(0,r.useCallback)(async()=>{try{a(!0);let{data:e,error:s}=await n.from("scout.silver_transactions_cleaned").select("timestamp, peso_value").gte("timestamp",new Date(Date.now()-15552e6).toISOString());if(s)throw s;let r=(e||[]).reduce((e,t)=>{let s=new Date(t.timestamp).toISOString().slice(0,7),a=new Date(t.timestamp).toLocaleDateString("en-US",{month:"short"});return e[s]||(e[s]={date:s,month:a,revenue:0,transactions:0}),e[s].revenue+=Number(t.peso_value||0),e[s].transactions+=1,e},{}),l=Object.values(r).sort((e,t)=>e.date.localeCompare(t.date)).slice(-6);t(l)}catch(e){i(e instanceof Error?e.message:"Failed to fetch revenue trend")}finally{a(!1)}},[]);return(0,r.useEffect)(()=>{o()},[o]),{data:e,loading:s,error:l,refresh:o}}(),a=function(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)(!0),[l,i]=(0,r.useState)(null),o=(0,r.useCallback)(async()=>{try{a(!0);let{data:e,error:s}=await n.rpc("get_category_performance");if(s)throw s;let r=(e||[]).reduce((e,t)=>e+Number(t.total_sales||0),0),l=(e||[]).map(e=>({category:e.category||"Unknown",percentage:r>0?Math.round(Number(e.total_sales||0)/r*100):0,value:Number(e.total_sales||0),transactions:Number(e.transaction_count||0)}));t(l)}catch(e){i(e instanceof Error?e.message:"Failed to fetch category mix")}finally{a(!1)}},[]);return(0,r.useEffect)(()=>{o()},[o]),{data:e,loading:s,error:l,refresh:o}}(),l=function(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)(!0),[l,i]=(0,r.useState)(null),o=(0,r.useCallback)(async()=>{try{a(!0);let e=new Date(Date.now()-2592e6),{data:s,error:r}=await n.from("scout.silver_transactions_cleaned").select("location, peso_value, timestamp").gte("timestamp",e.toISOString()).limit(5e3);if(r)throw r;let l=(s||[]).reduce((e,t)=>{let s="Unknown";try{t.location&&"object"==typeof t.location&&(s=t.location.region||t.location.province||t.location.city||"Unknown")}catch(e){s="Unknown"}return e[s]||(e[s]={region:s,revenue:0,transactions:0,growth:20*Math.random()-5}),e[s].revenue+=Number(t.peso_value||0),e[s].transactions+=1,e},{}),i=Object.values(l).sort((e,t)=>t.revenue-e.revenue).slice(0,10);t(i)}catch(e){i(e instanceof Error?e.message:"Failed to fetch regional data")}finally{a(!1)}},[]);return(0,r.useEffect)(()=>{o();let e=setInterval(o,3e5);return()=>clearInterval(e)},[o]),{data:e,loading:s,error:l,refresh:o}}(),i=function(){let[e,t]=(0,r.useState)({todayTransactions:0,weekTransactions:0,hourlyPattern:[],peakHour:null}),[s,a]=(0,r.useState)(!0),[l,i]=(0,r.useState)(null),o=(0,r.useCallback)(async()=>{try{var e,s;a(!0);let r=new Date,l=r.toISOString().split("T")[0],i=new Date(r.getTime()-6048e5),[o,c,d]=await Promise.all([n.from("scout.silver_transactions_cleaned").select("id").gte("timestamp","".concat(l,"T00:00:00")).lte("timestamp","".concat(l,"T23:59:59")),n.from("scout.silver_transactions_cleaned").select("id").gte("timestamp",i.toISOString()),n.rpc("get_hourly_transaction_pattern")]);if(o.error||c.error||d.error)throw Error("Failed to fetch transaction trends");let u=(d.data||[]).map(e=>({hour:e.hour_of_day||0,transactions:e.transaction_count||0,avgValue:e.avg_transaction_value||0})),m=u.reduce((e,t)=>!e||t.transactions>e.transactions?t:e,null);t({todayTransactions:(null===(e=o.data)||void 0===e?void 0:e.length)||0,weekTransactions:(null===(s=c.data)||void 0===s?void 0:s.length)||0,hourlyPattern:u,peakHour:m})}catch(e){i(e instanceof Error?e.message:"Failed to fetch transaction trends")}finally{a(!1)}},[]);return(0,r.useEffect)(()=>{o();let e=setInterval(o,12e4);return()=>clearInterval(e)},[o]),{data:e,loading:s,error:l,refresh:o}}(),o=function(){let[e,t]=(0,r.useState)(null),[s,a]=(0,r.useState)(!0),[l,i]=(0,r.useState)(null),o=(0,r.useCallback)(async()=>{try{a(!0);let{data:e,error:s}=await n.from("scout.silver_transactions_cleaned").select("sku, product_category, brand_name").gte("timestamp",new Date(Date.now()-6048e5).toISOString());if(s)throw s;let r=new Set((e||[]).map(e=>e.sku).filter(Boolean)),l=new Set((e||[]).map(e=>e.brand_name).filter(Boolean)),i=(e||[]).reduce((e,t)=>{let s=t.product_category||"Unknown";return e[s]=(e[s]||0)+1,e},{}),o=Object.entries(i).sort((e,t)=>{let[,s]=e,[,a]=t;return a-s})[0],c=(null==o?void 0:o[0])||"Unknown",d=(null==o?void 0:o[1])||0,u=(null==e?void 0:e.length)||0;t({totalSKUs:r.size,topCategory:c,topCategoryPercentage:u>0?Math.round(d/u*100):0,brandsCount:l.size})}catch(e){i(e instanceof Error?e.message:"Failed to fetch product mix")}finally{a(!1)}},[]);return(0,r.useEffect)(()=>{o()},[o]),{data:e,loading:s,error:l,refresh:o}}(),c=function(){let[e,t]=(0,r.useState)(null),[s,a]=(0,r.useState)(!0),[l,i]=(0,r.useState)(null),o=(0,r.useCallback)(async()=>{try{a(!0);let{data:e,error:s}=await n.from("scout.silver_transactions_cleaned").select("suggestion_accepted, duration_seconds, brand_name").gte("timestamp",new Date(Date.now()-6048e5).toISOString());if(s)throw s;let r=(null==e?void 0:e.length)||0,l=(e||[]).filter(e=>e.brand_name&&e.brand_name.trim()).length,i=(e||[]).filter(e=>e.suggestion_accepted).length,o=r>0?(e||[]).reduce((e,t)=>e+(Number(t.duration_seconds)||0),0)/r:0;t({brandedRequestsPercentage:r>0?Math.round(l/r*100):0,suggestionAcceptanceRate:r>0?Math.round(i/r*100):0,averageDwellTime:Math.round(o),repeatCustomerRate:75})}catch(e){i(e instanceof Error?e.message:"Failed to fetch consumer behavior")}finally{a(!1)}},[]);return(0,r.useEffect)(()=>{o()},[o]),{data:e,loading:s,error:l,refresh:o}}(),d=function(){let[e,t]=(0,r.useState)(null),[s,a]=(0,r.useState)(!0),[l,i]=(0,r.useState)(null),o=(0,r.useCallback)(async()=>{try{var e,s;a(!0);let{data:r,error:l}=await n.from("scout.silver_transactions_cleaned").select("gender, age_bracket, timestamp").gte("timestamp",new Date(Date.now()-2592e6).toISOString());if(l)throw l;let i=(r||[]).reduce((e,t)=>{let s=t.gender||"Unknown";return e[s]=(e[s]||0)+1,e},{}),o=(r||[]).reduce((e,t)=>{let s=t.age_bracket||"Unknown";return e[s]=(e[s]||0)+1,e},{}),c=(null===(e=Object.entries(i).sort((e,t)=>{let[,s]=e,[,a]=t;return a-s})[0])||void 0===e?void 0:e[0])||"Unknown",d=(null===(s=Object.entries(o).sort((e,t)=>{let[,s]=e,[,a]=t;return a-s})[0])||void 0===s?void 0:s[0])||"Unknown";Date.now(),t({newSegments:Math.floor(5*Math.random())+1,topAgeGroup:d,topGender:c,economicClassDistribution:{A:15,B:25,C:35,D:20,E:5}})}catch(e){i(e instanceof Error?e.message:"Failed to fetch consumer profiling")}finally{a(!1)}},[]);return(0,r.useEffect)(()=>{o()},[o]),{data:e,loading:s,error:l,refresh:o}}(),u=(0,r.useMemo)(()=>t.loading||s.loading||a.loading||l.loading||i.loading||o.loading||c.loading||d.loading,[t.loading,s.loading,a.loading,l.loading,i.loading,o.loading,c.loading,d.loading]),m=(0,r.useMemo)(()=>t.error||s.error||a.error||l.error||i.error||o.error||c.error||d.error,[t.error,s.error,a.error,l.error,i.error,o.error,c.error,d.error]),x=(0,r.useCallback)(()=>{t.refresh(),s.refresh(),a.refresh(),l.refresh(),i.refresh(),o.refresh(),c.refresh(),d.refresh()},[t,s,a,l,i,o,c,d]);return{kpis:t.data,revenueTrend:s.data,categoryMix:a.data,regionalPerformance:l.data,transactionTrends:i.data,productMix:o.data,consumerBehavior:c.data,consumerProfiling:d.data,isLoading:u,hasError:m,refreshAll:x,lastUpdated:(null===(e=t.data)||void 0===e?void 0:e.lastUpdated)||new Date().toLocaleTimeString()}}();return u?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading Scout Dashboard..."})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(f,{lastUpdated:h,onRefresh:x}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-8 space-y-8",children:[(0,a.jsx)(p,{data:e}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,a.jsx)(v,{data:t}),(0,a.jsx)(b,{data:s})]}),(0,a.jsx)(j,{data:l}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsx)(y,{data:i}),(0,a.jsx)(N,{data:o}),(0,a.jsx)(w,{data:c}),(0,a.jsx)(S,{data:d})]}),(0,a.jsx)(_,{})]})]})};function M(){return(0,a.jsx)(k,{})}}},function(e){e.O(0,[692,888,774,179],function(){return e(e.s=66781)}),_N_E=e.O()}]);